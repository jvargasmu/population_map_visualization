
<!DOCTYPE html>
<html>
<head>
  <title>Leaflet Preview</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css">

  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
   integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
   crossorigin=""></script>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>


  <style type="text/css">
    #map {
      height: 600px;
      width: 900px;
    }

    .area-tooltip {
        background: #363636;
        background: rgba(0,0,0,0.5);
        border: none;
        color: #f8d5e4;
    }

    .info {
        padding: 6px 8px;
        font: 14px/16px Arial, Helvetica, sans-serif;
        background: white;
        background: rgba(255,255,255,0.9);
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        border-radius: 5px;
    }
    .info h4 {
        margin: 0 0 5px;
        color: #777;
    }
    .legend {
        line-height: 18px;
        color: #555;
    }
    .legend i {
        width: 18px;
        height: 18px;
        float: left;
        margin-right: 8px;
        opacity: 0.7;
    }

  </style>
</head>
<body>
  <div id="map"></div>
  <script>

      function createAreaTooltip(layer) {
            if(layer.areaTooltip) {
                //console.log("not areaTooltip")
                return;
            }
            //console.log("creating areaTooltip")
            layer.areaTooltip = L.tooltip({
                permanent: true,
                direction: 'center',
                className: 'area-tooltip'
            });

            layer.on('remove', function(event) {
                layer.areaTooltip.remove();
            });

            layer.on('add', function(event) {
                updateAreaTooltip(layer);
                layer.areaTooltip.addTo(map);
            });

            if(map.hasLayer(layer)) {
                updateAreaTooltip(layer);
                layer.areaTooltip.addTo(map);
            }
      }

      function updateAreaTooltip(layer) {
            var area = L.GeometryUtil.geodesicArea(layer.getLatLngs()[0]);
            var readableArea = L.GeometryUtil.readableArea(area, true);
            var latlng = layer.getCenter();

            layer.areaTooltip
                .setContent(readableArea)
                .setLatLng(latlng);
      }
      
      // Base layers
      var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'});

      var white = L.tileLayer("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAQMAAABmvDolAAAAA1BMVEX///+nxBvIAAAAH0lEQVQYGe3BAQ0AAADCIPunfg43YAAAAAAAAAAA5wIhAAAB9aK9BAAAAABJRU5ErkJggg==");

      //var map = L.map('map').setView([-6.363749772999999, 34.8862498755], 12.0);
      var map = L.map('map', {
            center: [-25.9491, 32.5857], // center in Dar es salam [-6.83278, 39.25927], //orignal:[-6.363749772999999, 34.8862498755],
            zoom: 12,
            minZoom: 5,
            maxZoom: 14,
            layers: [osm]
        });
      
      var lyr =L.tileLayer('file:////Users/john.vargas/data/pomelo_popmaps/V3_moz_final1_z5_14/{z}/{x}/{y}.png', {
        minZoom: 5,
        maxZoom: 14,
        tms: false,
        attribution: 'Generated by TilesXYZ'
      }).addTo(map);

      var basemaps = {"OpenStreetMap": osm, "Without background": white}
      var overlaymaps = {"Layer": lyr}

      // Add base layers
      L.control.layers(basemaps, overlaymaps, {collapsed: false}).addTo(map);

      //------ Add the draw tool 
      //polygon = L.polygon([
      //      [-6.83278, 39.25927],
      //      [-6.83345, 39.25819],
      //      [-6.83678, 39.25589]
      //  ]).addTo(map);
      current_polygon = L.polygon([])//.addTo(map);
      
      createAreaTooltip(current_polygon);

      var drawnItems = L.featureGroup().addTo(map);

      map.addControl(new L.Control.Draw({
          edit: {
              featureGroup: drawnItems,
              poly: {
                  allowIntersection: false
              }
          },
          draw: {
              marker: false,
              circle: false,
              circlemarker: false,
              rectangle: false,
              polyline: false,
              polygon: {
                  allowIntersection: false,
                  showArea: true
              }
          }
      }));

      map.on(L.Draw.Event.CREATED, function(event) {
            var layer = event.layer;

            if(layer instanceof L.Polygon) {
                createAreaTooltip(layer);
                console.log("event created");
                console.log(layer._latlngs);
                //console.log(current_polygon._latlngs);
                //layer._latlngs.forEach(function(coord){
                //  console.log(coord)
                //})

                //cordinates
                //​​[(39.23149108886719,  -6.848714164864813), (39.291915893554695, -6.824511570973096)
                //(39.30118560791016, -6.844282795711849), (39.29637908935547, -6.864053201600376),
                //(39.277153015136726, -6.8797325948982895), (39.25140380859376, -6.888935476020913),
                //(39.21844482421876, -6.872233819142411), (39.21810150146485, -6.858258512427753)]

                //custom_pol = [{'type':'Polygon', 'coordinates':[[(39.23149108886719,  -6.848714164864813), (39.291915893554695, -6.824511570973096),(39.30118560791016, -6.844282795711849), (39.29637908935547, -6.864053201600376),(39.277153015136726, -6.8797325948982895), (39.25140380859376, -6.888935476020913),(39.21844482421876, -6.872233819142411), (39.21810150146485, -6.858258512427753)]] }]
                //tza_raster = rasterio.open(image_path)
                //out_image, transformed = rasterio.mask.mask(tza_raster, custom_pol, crop=True, filled=True)
                //
            }

            drawnItems.addLayer(layer);
      });

      map.on(L.Draw.Event.EDITED, function(event) {
          event.layers.getLayers().forEach(function(layer) {
              if(layer instanceof L.Polygon) {
                  updateAreaTooltip(layer);
                  //console.log("event edited");
                  //console.log(layer._latlngs);
              }
          })
      });

      // Iterate over all the polygon layers to do stuff with it
      //map.eachLayer( function(layer) { if(layer instanceof L.Polygon) { console.log(layer._latlngs) } })

      // Add legend in the bottom rigtht
      function getColor(d) {
          return d > 1000 ? '#800026' :
                 d > 500  ? '#BD0026' :
                 d > 200  ? '#E31A1C' :
                 d > 100  ? '#FC4E2A' :
                 d > 50   ? '#FD8D3C' :
                 d > 20   ? '#FEB24C' :
                 d > 10   ? '#FED976' :
                            '#FFEDA0';
      }
      function getColorMOZ(d) {
          return d > 200  ? '#fde725' :
                 d > 150  ? '#65cb5e' :
                 d > 100  ? '#20928c' :
                 d > 50   ? '#3a538b' :
                 d > 25   ? '#46307e' :
                 d > 10   ? '#481769' :
                 d > 5    ? '#471063' :
                            '#440154';
      }

      var legend = L.control({position: 'bottomright'});

      legend.onAdd = function (map) {

          var div = L.DomUtil.create('div', 'info legend'),
              grades = [1, 5, 25, 50, 100, 150, 200, 385],
              //grades = [0, 10, 20, 50, 100, 200, 500, 1000],
              labels = [];

          // loop through our density intervals and generate a label with a colored square for each interval
          //for (var i = 0; i < grades.length-1; i++) {
          for (var i = grades.length-2; i >= 0 ; i--) {
              div.innerHTML +=
                  '<i style="background:' + getColorMOZ(grades[i] + 1) + '"></i> ' +
                  grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
          }

          return div;
      };

      legend.addTo(map);


  </script>
</body>
</html>
